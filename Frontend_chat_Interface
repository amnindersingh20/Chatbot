function saveSurveyResponse(pageName) {
  var host = sessionStorage.getItem("host").split('validate')[0];
  var ssoData = JSON.parse(sessionStorage.getItem('ssoData'));
  var token = sessionStorage.getItem("token");

  var dataObj = {};
  dataObj.projectId = "Marriott_SURVEY";
  dataObj.surveyBatchId = "2026";  // or ssoData.planYear if valid
  dataObj.overwritePrevResp = false;

  // Pull from sessionStorage instead of undefined globals
  dataObj.r1  = sessionStorage.getItem("r1")  || "0";
  dataObj.r2a = sessionStorage.getItem("r2a") || "0";
  dataObj.r2b = sessionStorage.getItem("r2b") || "0";
  ...
  dataObj.r36 = sessionStorage.getItem("r36") || "";

  var responseJson = JSON.stringify(dataObj);
  console.log("Sending:", responseJson);

  var url = host + "saveSurveyResponseForAuthUser";

  const request = new Request(url, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "DSI-Session-Token": ssoData.dsiSessionToken,
      "DSI-Person-Token": token
    },
    body: responseJson,
  });

  fetch(request)
    .then(response => {
      if (response.status === 200) {
        return response.text();
      } else {
        throw new Error("Error saving: " + response.status);
      }
    })
    .then(responseData => {
      console.log("Server replied:", responseData);
    })
    .catch(error => {
      console.error("Save failed:", error);
      alert("There has been an error processing your request. Please close the browser and retry.");
    });
}
