function formatResponse(text) {
            // Split into paragraphs preserving natural line breaks
            const paragraphs = text.split('\n').filter(p => p.trim() !== '');
            
            // Clear previous content
            responseContent.innerHTML = '';
            
            let currentList = null;
            
            paragraphs.forEach(paragraph => {
                const trimmed = paragraph.trim();
                const wrapper = document.createElement('div');
                wrapper.classList.add('fade-in');

                // Check for numbered list item
                if (/^\d+\.\s/.test(trimmed)) {
                    if (!currentList) {
                        currentList = document.createElement('ol');
                        currentList.className = 'numbered-list';
                        wrapper.appendChild(currentList);
                    }
                    
                    const li = document.createElement('li');
                    li.textContent = trimmed.replace(/^\d+\.\s*/, '');
                    currentList.appendChild(li);
                }
                // Check for bullet points
                else if (/^[-*•]\s/.test(trimmed)) {
                    if (currentList) {
                        currentList = null;
                    }
                    const ul = document.createElement('ul');
                    ul.className = 'bullet-list';
                    const li = document.createElement('li');
                    li.textContent = trimmed.replace(/^[-*•]\s*/, '');
                    ul.appendChild(li);
                    wrapper.appendChild(ul);
                }
                // Regular paragraph
                else {
                    if (currentList) {
                        currentList = null;
                    }
                    const p = document.createElement('p');
                    p.textContent = trimmed;
                    wrapper.appendChild(p);
                }
                
                if (!currentList || wrapper.children.length > 0) {
                    responseContent.appendChild(wrapper);
                }
            });
        }
