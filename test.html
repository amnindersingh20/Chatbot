function formatResponse(text) {
            // Convert response text to formatted HTML
            const wrapper = document.createElement('div');
            
            // Split into paragraphs while preserving list structure
            const blocks = text.split('\n\n');
            
            blocks.forEach(block => {
                // Detect numbered lists
                if (/^\d+\.\s/.test(block)) {
                    const ol = document.createElement('ol');
                    block.split('\n').forEach(item => {
                        const li = document.createElement('li');
                        li.textContent = item.replace(/^\d+\.\s/, '');
                        ol.appendChild(li);
                    });
                    wrapper.appendChild(ol);
                }
                // Detect bulleted lists
                else if (/^[-*•]\s/.test(block)) {
                    const ul = document.createElement('ul');
                    block.split('\n').forEach(item => {
                        const li = document.createElement('li');
                        li.textContent = item.replace(/^[-*•]\s/, '');
                        ul.appendChild(li);
                    });
                    wrapper.appendChild(ul);
                }
                // Regular paragraph
                else {
                    const p = document.createElement('p');
                    p.textContent = block;
                    wrapper.appendChild(p);
                }
            });

            return wrapper.innerHTML;
        }

        function appendMessage(message, isUser) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
            
            const bubble = document.createElement('div');
            bubble.className = 'message-bubble';
            
            if (isUser) {
                bubble.textContent = message;
            } else {
                bubble.innerHTML = formatResponse(message);
            }
            
            messageDiv.appendChild(bubble);
            chatHistory.appendChild(messageDiv);
            
            // Scroll to bottom
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }
