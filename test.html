function formatResponse(text) {
            const wrapper = document.createElement('div');
            const blocks = text.split('\n\n');  // Split by paragraphs
            let currentList = null;

            blocks.forEach(block => {
                const lines = block.split('\n').filter(l => l.trim() !== '');
                
                // Check for numbered list block
                if (lines.every(line => /^\d+\.\s/.test(line.trim()))) {
                    currentList = document.createElement('ol');
                    lines.forEach(line => {
                        const li = document.createElement('li');
                        li.textContent = line.replace(/^\d+\.\s*/, '').trim();
                        currentList.appendChild(li);
                    });
                    wrapper.appendChild(currentList);
                }
                // Check for bulleted list block
                else if (lines.every(line => /^[-*•]\s/.test(line.trim()))) {
                    currentList = document.createElement('ul');
                    lines.forEach(line => {
                        const li = document.createElement('li');
                        li.textContent = line.replace(/^[-*•]\s*/, '').trim();
                        currentList.appendChild(li);
                    });
                    wrapper.appendChild(currentList);
                }
                // Regular text block
                else {
                    currentList = null;
                    const p = document.createElement('p');
                    p.textContent = block.trim();
                    wrapper.appendChild(p);
                }
            });

            return wrapper.innerHTML;
        }
